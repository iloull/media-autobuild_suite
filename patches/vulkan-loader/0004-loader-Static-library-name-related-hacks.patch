From b49754d0a545d66d1c548d2f8dc57b93cc7bcb92 Mon Sep 17 00:00:00 2001
From: Christopher Degawa <ccom@randomderp.com>
Date: Mon, 2 Oct 2023 01:38:44 -0500
Subject: [PATCH 4/5] loader: Static library name related hacks

Re-adds the lib prefix and removes the so-ver suffixes

Signed-off-by: Christopher Degawa <ccom@randomderp.com>
---
 loader/CMakeLists.txt | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/loader/CMakeLists.txt b/loader/CMakeLists.txt
index 3d03c6377..eceeb5e16 100644
--- a/loader/CMakeLists.txt
+++ b/loader/CMakeLists.txt
@@ -391,14 +391,16 @@ if(WIN32)
     # when adding the suffix the import and runtime library names must be consistent
     # mingw: libvulkan-1.dll.a / vulkan-1.dll
     # msvc: vulkan-1.lib / vulkan-1.dll
-    set_target_properties(vulkan
-                          PROPERTIES
-                          OUTPUT_NAME ${API_TYPE}-1)
-    if(MINGW)
-        # generate the same DLL with mingw
+    if (NOT BUILD_STATIC_LOADER)
         set_target_properties(vulkan
                               PROPERTIES
-                              PREFIX "")
+                              OUTPUT_NAME ${API_TYPE}-1)
+        if(MINGW)
+            # generate the same DLL with mingw
+            set_target_properties(vulkan
+                                  PROPERTIES
+                                  PREFIX "")
+        endif()
     endif()

     if(MSVC AND ENABLE_WIN10_ONECORE)
@@ -559,7 +563,7 @@ if (PKG_CONFIG_FOUND)
         set(PRIVATE_LIBS "Libs.private: ${PRIVATE_LIBS}")
     endif()
 
-    if(WIN32)
+    if(WIN32 AND NOT BUILD_STATIC_LOADER)
         if(MINGW)
             set(VULKAN_LIB_SUFFIX "-1.dll")
         else()
-- 
2.50.1

